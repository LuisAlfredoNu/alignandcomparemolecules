#!/bin/bash

echo "list of comparations" > list_Comparations.dat
for i in $(ls)
do
	if [[ -d "$i/Opt_Geo" ]]
	then
		cd $i/Opt_Geo
		for iii in $(ls *.xyz)
		do
			echo "$i/Opt_Geo/$iii" >> tmp_list.tmp
		done
		n_comparations=$(cat tmp_list.tmp|wc -l)
		for ((ii=$n_comparations;ii>0;ii--))
		do
			first_name=$(tail -n $ii tmp_list.tmp | head -n 1)
			tail -n $(($ii-1)) tmp_list.tmp | awk -v x=$first_name '{print x"\t"$1}' >> ../../list_Comparations.dat
		done
		rm tmp_list.tmp
		cd ../..
	fi
done

mkdir -p Comparations

echo "Errors in the comparation" > error.tmp

while read -r line 
do
	filenameA=$(echo $line | awk '{print $1}')
	short_filenameA_tmp=${filenameA#*Opt_Geo\/*}
	short_filenameA=${short_filenameA_tmp%.xyz}
	filenameB=$(echo $line | awk '{print $2}')
	short_filenameB_tmp=${filenameB#*Opt_Geo\/*}
	short_filenameB=${short_filenameB_tmp%.xyz}

	file_name_comparation="Comparations/comparations_$short_filenameA-with-$short_filenameB.output"
	../src/alignandcomparemolecule/alignandcomparemolecule.x $line > $file_name_comparation
	
	error_of_comparation=$?

	echo $error_of_comparation >> error.tmp
	if (( $error_of_comparation ))
	then
		echo "Error in comparation $file_name_comparation"
		rm $file_name_comparation
	fi
done < list_Comparations.dat
